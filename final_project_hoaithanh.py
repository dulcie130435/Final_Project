# -*- coding: utf-8 -*-
"""Final Project - HoaiThanh.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1hSVeCvYeQvhUrJLBbMKy3CYuoSVVCguf

# D·ª± B√°o Doanh S·ªë V√† Ph√¢n T√≠ch L·ª£i Nhu·∫≠n Cho Chu·ªói Si√™u Th·ªã

## 1. Gi·ªõi thi·ªáu D·ª± √°n

D·ª± √°n n√†y t·∫≠p trung v√†o vi·ªác *d·ª± b√°o doanh s·ªë b√°n h√†ng* v√† *ph√¢n t√≠ch l·ª£i nhu·∫≠n* c·ªßa chu·ªói c·ª≠a h√†ng b√°n l·∫ª (Superstore) b·∫±ng c√°c m√¥ h√¨nh chu·ªói th·ªùi gian (time series) v√† *ph√¢n t√≠ch d·ªØ li·ªáu kinh doanh*.

* M·ª•c ti√™u ch√≠nh:
    * D·ª± b√°o doanh s·ªë (Sales Forecasting) cho Superstore trong 6 th√°ng t·ªõi b·∫±ng m√¥ h√¨nh Holt-Winter Forecast.
    * Ph√¢n t√≠ch l·ª£i nhu·∫≠n (Profit Analysis) ƒë·ªÉ x√°c ƒë·ªãnh y·∫øu t·ªë ·∫£nh h∆∞·ªüng ƒë·∫øn l·ª£i nhu·∫≠n, ph√¢n kh√∫c kh√°ch h√†ng v√† danh m·ª•c h√†ng h√≥a hi·ªáu qu·∫£.
    * ƒê·ªÅ xu·∫•t chi·∫øn l∆∞·ª£c c·∫£i thi·ªán doanh thu v√† l·ª£i nhu·∫≠n d·ª±a tr√™n k·∫øt qu·∫£ m√¥ h√¨nh v√† insight th·ª±c t·∫ø.

## 2. Ph∆∞∆°ng ph√°p (Methodology)

* **Ph√¢n t√≠ch m√¥ t·∫£ (Descriptive Analysis):**
  S·ª≠ d·ª•ng c√°c ch·ªâ s·ªë th·ªëng k√™ v√† bi·ªÉu ƒë·ªì tr·ª±c quan (c·ªôt, ƒë∆∞·ªùng, heatmap) ƒë·ªÉ nh·∫≠n di·ªán xu h∆∞·ªõng kinh doanh ch√≠nh nh∆∞ doanh thu theo th√°ng, ph√¢n b·ªë ƒë∆°n h√†ng theo ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn v√† t√°c ƒë·ªông c·ªßa chi·∫øt kh·∫•u ƒë·∫øn l·ª£i nhu·∫≠n.

* **Ph√¢n t√≠ch t∆∞∆°ng quan (Correlation Analysis):**
  ƒê√°nh gi√° m·ªëi quan h·ªá gi·ªØa c√°c bi·∫øn kinh doanh ch·ªß ch·ªët ‚Äî chi·∫øt kh·∫•u, doanh thu, l·ª£i nhu·∫≠n v√† bi√™n l·ª£i nhu·∫≠n ‚Äî nh·∫±m x√°c ƒë·ªãnh ·∫£nh h∆∞·ªüng c·ªßa ch√≠nh s√°ch chi·∫øt kh·∫•u ƒë·∫øn hi·ªáu qu·∫£ ho·∫°t ƒë·ªông.

* **M√¥ h√¨nh d·ª± b√°o (Forecasting Model):**
  √Åp d·ª•ng m√¥ h√¨nh Holt‚ÄìWinters Exponential Smoothing ƒë·ªÉ d·ª± b√°o doanh thu 6‚Äì12 th√°ng t·ªõi, t·∫≠n d·ª•ng ƒë·∫∑c ƒëi·ªÉm xu h∆∞·ªõng (*trend*) v√† m√πa v·ª• (*seasonality*) c·ªßa d·ªØ li·ªáu.

* **Ki·ªÉm ƒë·ªãnh:**
  X√¢y d·ª±ng c√°c k·ªãch b·∫£n gi·∫£m chi·∫øt kh·∫•u ƒë·ªÉ ph√¢n t√≠ch t√°c ƒë·ªông ti·ªÅm nƒÉng ƒë·∫øn doanh thu v√† l·ª£i nhu·∫≠n, h·ªó tr·ª£ ra quy·∫øt ƒë·ªãnh kinh doanh chi·∫øn l∆∞·ª£c.

## 3. Ph√¢n t√≠ch (Analysis)

### 3.1. Chu·∫©n b·ªã d·ªØ li·ªáu
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import statsmodels.api as sm

df = pd.read_csv('Sample_Superstore.csv', encoding='ISO-8859-1', parse_dates=['Order Date','Ship Date'])
df.head()

"""**Ki·ªÉm tra t·ªïng quan**"""

df.info()

"""**Data Cleaning**"""

# Chu·∫©n h√≥a t√™n c·ªôt
df.columns = df.columns.str.replace(' ', '_').str.replace('-', '_').str.lower()
df.columns

#  Ki·ªÉm tra c√°c gi√° tr·ªã tr√πng l·∫∑p
df.duplicated().sum()

# X√≥a c√°c gi√° tr·ªã tr√πng l·∫∑p
df.drop_duplicates(inplace=True)

# Ki·ªÉm tra d·ªØ li·ªáu b·ªã thi·∫øu
df.isnull().sum()

# Lo·∫°i b·ªè c√°c d√≤ng thi·∫øu th√¥ng tin c·∫ßn thi·∫øt
df = df.dropna(subset=['sales', 'ship_mode', 'region', 'segment'])

# X·ª≠ l√Ω datatypes
df = df.convert_dtypes()

# Chuy·ªÉn c√°c c·ªôt c·∫ßn thi·∫øt v·ªÅ d·∫°ng "category"
cols = ['country','city','state','region','category','sub_category']
df[cols] = df[cols].astype('category')

# Ki·ªÉm tra l·∫°i th√¥ng tin data
df.info()

"""### 3.2. Ph√¢n t√≠ch kh√°m ph√° d·ªØ li·ªáu (EDA)"""

# Chi ph√≠ ∆∞·ªõc t√≠nh cho m·ªói giao d·ªãch
df['cost'] = df['sales'] - df['profit']

# T·ª∑ su·∫•t l·ª£i nhu·∫≠n
df['profit_margin'] = (df['profit'] / df['sales']) * 100

# Th·ªùi gian v·∫≠n chuy·ªÉn
df['shipping_time'] = (df['ship_date'] - df['order_date']).dt.days.astype(int)

# Gi√° b√°n trung b√¨nh cho m·ªói s·∫£n ph·∫©m
df['sales_per_quantity'] = df['sales'] / df['quantity']

# ƒê∆°n h√†ng l√£i/l·ªó
df['is_gain']=np.where(df['profit']>0,1,0)

# X·ª≠ l√Ω c·ªôt th·ªùi gian
df['month_order']=df['order_date'].dt.month
df['year_order']=df['order_date'].dt.year

df.columns

df.shape

df.info()

"""### 3.3. T·ªïng quan hi·ªáu su·∫•t kinh doanh"""

df.describe()

# --- T√≠nh t·ªïng doanh thu, l·ª£i nhu·∫≠n v√† bi√™n l·ª£i nhu·∫≠n trung b√¨nh ---
total_sales = df['sales'].sum()
total_profit = df['profit'].sum()
avg_margin = (total_profit / total_sales) * 100

print(" HI·ªÜU QU·∫¢ KINH DOANH T·ªîNG QUAN")
print("T·ªïng doanh thu:", round(total_sales, 2))
print("T·ªïng l·ª£i nhu·∫≠n:", round(total_profit, 2))
print("Bi√™n l·ª£i nhu·∫≠n trung b√¨nh:", round(avg_margin, 2), "%")

# --- T√≠nh t·ª∑ l·ªá ƒë∆°n h√†ng c√≥ l√£i v√† l·ªó ---
total_orders = len(df)
gain_orders = df['is_gain'].sum()
loss_orders = total_orders - gain_orders

gain_rate = (gain_orders / total_orders) * 100
loss_rate = (loss_orders / total_orders) * 100

print("\n PH√ÇN B·ªî ƒê∆†N H√ÄNG C√ì L√ÉI / L·ªñ")
print("ƒê∆°n h√†ng c√≥ l√£i:", gain_orders, "(", round(gain_rate, 2), "% )")
print("ƒê∆°n h√†ng l·ªó:", loss_orders, "(", round(loss_rate, 2), "% )")

# --- T√≠nh chi·∫øt kh·∫•u trung b√¨nh ---
avg_discount = df['discount'].mean() * 100
print("\nChi·∫øt kh·∫•u trung b√¨nh:", round(avg_discount, 2), "%")

# --- V·∫Ω bi·ªÉu ƒë·ªì tr√≤n th·ªÉ hi·ªán t·ª∑ l·ªá ƒë∆°n h√†ng c√≥ l√£i / l·ªó ---
plt.figure(figsize=(5,5))
plt.pie([gain_orders, loss_orders],
        labels=['C√≥ l√£i', 'L·ªó'],
        autopct='%1.1f%%',
        colors=['lightblue', 'lightcoral'])
plt.title('T·ª∑ l·ªá ƒë∆°n h√†ng c√≥ l√£i / l·ªó')
plt.show()

region_sales = df.groupby("region")["sales"].sum()

plt.figure(figsize=(5, 5))
plt.pie(region_sales,
        labels=region_sales.index,
        autopct=lambda p: f'{p:.1f}%\n(${p * region_sales.sum() / 100:,.0f})',
        startangle=90,
        colors=sns.color_palette("Set2", len(region_sales)))
plt.title("Sales by Region")
plt.show()

# --- Histogram ph√¢n ph·ªëi Discount ---
plt.figure(figsize=(6,4))
sns.histplot(df['discount'], bins=30, color='gold', kde=True)
plt.title('Ph√¢n ph·ªëi Chi·∫øt kh·∫•u (Discount)', fontsize=13, fontweight='bold')
plt.xlabel('Discount')
plt.ylabel('S·ªë l∆∞·ª£ng ƒë∆°n h√†ng')
plt.show()

# T√≠nh t·ªïng l·ª£i nhu·∫≠n theo v√πng
region_profit = df.groupby('region')['profit'].sum().reset_index()

# V√πng c√≥ l·ª£i nhu·∫≠n cao nh·∫•t v√† th·∫•p nh·∫•t
top_profit_region = region_profit.loc[region_profit['profit'].idxmax()]
bottom_profit_region = region_profit.loc[region_profit['profit'].idxmin()]

print("V√πng c√≥ L·ª¢I NHU·∫¨N CAO NH·∫§T:")
print(top_profit_region)

print("\n V√πng c√≥ L·ª¢I NHU·∫¨N TH·∫§P NH·∫§T:")
print(bottom_profit_region)

plt.figure(figsize=(10,5))
ax = sns.barplot(data=region_profit.sort_values('profit', ascending=False),
            x='region', y='profit', palette='Greens_d')

plt.title('T·ªïng l·ª£i nhu·∫≠n theo khu v·ª±c')
plt.xlabel('Khu v·ª±c')
plt.ylabel('T·ªïng l·ª£i nhu·∫≠n')
plt.grid(axis='y', linestyle='--', alpha=0.3)

for p in ax.patches:
    height = p.get_height()
    ax.text(
        x=p.get_x() + p.get_width()/2,
        y=height,
        s=f'{height/1000:.1f}K',ha='center',va='bottom',fontsize=10
    )

plt.tight_layout()
plt.show()

"""**Ph√¢n b·ªï s·ªë l∆∞·ª£ng ƒë∆°n h√†ng theo v√πng, s·∫£n ph·∫©m v√† ph√¢n kh√∫c**"""

# --- 3 b·∫£ng t·ªïng h·ª£p ---
orders_by_region = df.groupby('region', observed=True)['order_id'].nunique().reset_index()
orders_by_category = df.groupby('category', observed=True)['order_id'].nunique().reset_index()
orders_by_segment = df.groupby('segment', observed=True)['order_id'].nunique().reset_index()

# --- T·∫°o figure v·ªõi 3 bi·ªÉu ƒë·ªì trong 1 h√†ng ---
fig, axes = plt.subplots(1, 3, figsize=(18, 10))

# --- Bi·ªÉu ƒë·ªì 1: T·ªïng s·ªë ƒë∆°n h√†ng tr√™n kh·∫Øp khu v·ª±c ---
sns.barplot(x='region', y='order_id', data=orders_by_region, ax=axes[0], hue='region', palette='Blues_r')
axes[0].set_title('T·ªïng s·ªë ƒë∆°n h√†ng theo khu v·ª±c', fontsize=13)
axes[0].set_xlabel('Khu v·ª±c')
axes[0].set_ylabel('S·ªë l∆∞·ª£ng ƒë∆°n h√†ng')

for p in axes[0].patches:
    axes[0].annotate(f'{p.get_height():,.0f}',
                     (p.get_x() + p.get_width() / 2, p.get_height()),
                     ha='center', va='bottom', fontsize=10, color='black')

# --- Bi·ªÉu ƒë·ªì 2: T·ªïng s·ªë ƒë∆°n h√†ng theo danh m·ª•c s·∫£n ph·∫©m ---
sns.barplot(x='category', y='order_id', data=orders_by_category, ax=axes[1], hue='category', palette='Greens_r')
axes[1].set_title('T·ªïng s·ªë ƒë∆°n h√†ng theo danh m·ª•c s·∫£n ph·∫©m', fontsize=13)
axes[1].set_xlabel('Danh m·ª•c s·∫£n ph·∫©m')
axes[1].set_ylabel('')

for p in axes[1].patches:
    axes[1].annotate(f'{p.get_height():,.0f}',
                     (p.get_x() + p.get_width() / 2, p.get_height()),
                     ha='center', va='bottom', fontsize=10, color='black')

# --- Bi·ªÉu ƒë·ªì 3: T·ªïng s·ªë ƒë∆°n h√†ng theo ph√¢n kh√∫c ---
sns.barplot(x='segment', y='order_id', data=orders_by_segment, ax=axes[2], hue='segment', palette='Oranges_r')
axes[2].set_title('T·ªïng s·ªë ƒë∆°n h√†ng theo ph√¢n kh√∫c kh√°ch h√†ng', fontsize=13)
axes[2].set_xlabel('Ph√¢n kh√∫c kh√°ch h√†ng')
axes[2].set_ylabel('')

for p in axes[2].patches:
    axes[2].annotate(f'{p.get_height():,.0f}',
                     (p.get_x() + p.get_width() / 2, p.get_height()),
                     ha='center', va='bottom', fontsize=10, color='black')

plt.tight_layout()
plt.show()

"""### 3.4. Xu h∆∞·ªõng doanh s·ªë theo th·ªùi gian"""

# ------ T·ªîNG QUAN THEO NƒÇM & QU√ù ------

# --- T√≠nh t·ªïng doanh s·ªë theo nƒÉm ---
yearly_sales = df.groupby('year_order')['sales'].sum().reset_index()

# --- T√≠nh t·ªïng doanh s·ªë theo qu√Ω ---
df['quarter_order'] = df['order_date'].dt.quarter
quarterly_sales = df.groupby('quarter_order')['sales'].sum().reset_index()

# --- T·∫°o 2 bi·ªÉu ƒë·ªì c·∫°nh nhau ---
plt.figure(figsize=(10,5))

# Bi·ªÉu ƒë·ªì 1: Doanh s·ªë theo nƒÉm
plt.subplot(1, 2, 1)  # (1 h√†ng, 2 c·ªôt, bi·ªÉu ƒë·ªì th·ª© 1)
plt.bar(yearly_sales['year_order'], yearly_sales['sales'], color='skyblue')
plt.title('T·ªïng doanh thu theo nƒÉm')
plt.xlabel('NƒÉm')
plt.ylabel('T·ªïng doanh thu')
plt.xticks(yearly_sales['year_order'])
plt.grid(axis='y', linestyle='--', alpha=0.3)

for i, v in enumerate(yearly_sales['sales']):
    plt.text(yearly_sales['year_order'][i], v + max(yearly_sales['sales'])*0.01, f'{v/1000:.1f}K',
             ha='center', va='bottom')

# Bi·ªÉu ƒë·ªì 2: Doanh s·ªë theo qu√Ω
plt.subplot(1, 2, 2)  # (1 h√†ng, 2 c·ªôt, bi·ªÉu ƒë·ªì th·ª© 2)
plt.bar(quarterly_sales['quarter_order'], quarterly_sales['sales'], color='lightgreen')
plt.title('T·ªïng doanh thu theo qu√Ω')
plt.xlabel('Qu√Ω')
plt.ylabel('')
plt.xticks([1, 2, 3, 4])
plt.grid(axis='y', linestyle='--', alpha=0.3)

for i, v in enumerate(quarterly_sales['sales']):
    plt.text(quarterly_sales['quarter_order'][i], v + max(quarterly_sales['sales'])*0.01, f'{v/1000:.1f}K',
             ha='center', va='bottom')

plt.tight_layout()
plt.show()

# ------ Ki·ªÉm tra t√≠nh m√πa v·ª• (Seasonality) ------
# --- T√≠nh t·ªïng doanh s·ªë theo th√°ng ---
monthly_sales = df.groupby(['year_order', 'month_order'])['sales'].sum().reset_index()

# --- T√≠nh t·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng theo th√°ng ---
monthly_sales['MoM Growth (%)'] = monthly_sales['sales'].pct_change() * 100
monthly_sales['MoM Growth (%)'] = monthly_sales['MoM Growth (%)'].fillna(0)
# --- Hi·ªÉn th·ªã k·∫øt qu·∫£ ---
# print(monthly_sales)

monthly_sales['Period'] = monthly_sales['year_order'].astype(str) + '-' + monthly_sales['month_order'].astype(str)

plt.figure(figsize=(16,8))
plt.plot(monthly_sales['Period'], monthly_sales['MoM Growth (%)'], marker='o', color='blue')
plt.title('T·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng doanh thu theo th√°ng (%)', fontsize=20)
plt.xlabel('Th·ªùi gian (theo th√°ng)', fontsize=15)
plt.ylabel('T·ª∑ l·ªá tƒÉng tr∆∞·ªüng (%)', fontsize=15)
plt.grid(True, linestyle='--', alpha=0.3)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# --- Chu·∫©n b·ªã d·ªØ li·ªáu ---
monthly_yearly_avg = df.groupby(['year_order', 'month_order'])['sales'].mean().reset_index()
monthly_avg_all = df.groupby('month_order')['sales'].mean().reset_index()

# --- Pivot ƒë·ªÉ d·ªÖ v·∫Ω ---
pivot = monthly_yearly_avg.pivot(index='month_order', columns='year_order', values='sales')
pivot = pivot.sort_index()

months = pivot.index.values
years = pivot.columns.tolist()
n_years = len(years)
base_x = np.arange(len(months))
width = 0.8 / n_years

# --- B·∫£ng m√†u xanh cho c√°c nƒÉm ---
blue_palette = ['#c6dbef', '#9ecae1', '#6baed6', '#3182bd']

plt.figure(figsize=(14,6))

# --- V·∫Ω c·ªôt (bar) ---
for i, (yr, color) in enumerate(zip(years, blue_palette)):
    offsets = (i - (n_years-1)/2) * width
    x_positions = base_x + offsets
    plt.bar(
        x_positions,
        pivot[yr].values,
        width=width,
        label=str(yr),
        color=color,
        alpha=0.9,
        zorder=2
    )

# --- V·∫Ω ƒë∆∞·ªùng trung b√¨nh (Overall Avg) ---
overall_y = [monthly_avg_all.set_index('month_order').loc[m, 'sales'] for m in months]
plt.plot(
    base_x,
    overall_y,
    marker='o',
    linewidth=2.5,
    color='#08306b',
    label='Trung b√¨nh chung',
    zorder=3
)
plt.xticks(base_x, months)
plt.xlabel('Th√°ng')
plt.ylabel('Doanh s·ªë trung b√¨nh')
plt.title('Doanh s·ªë trung b√¨nh theo th√°ng giai ƒëo·∫°n 2014‚Äì2017 v√† xu h∆∞·ªõng chung', fontsize=20)
plt.grid(axis='y', linestyle='--', alpha=0.3)
plt.legend(title='NƒÉm', loc='upper left')
plt.tight_layout()
plt.show()

"""### 3.5. Ph√¢n t√≠ch theo v√πng (Region)

**V√πng n√†o ƒëang d·∫´n ƒë·∫ßu doanh s·ªë?**
"""

# T√≠nh t·ªïng doanh thu theo v√πng
region_sales = df.groupby('region')['sales'].sum().reset_index()

# V√πng c√≥ doanh thu cao nh·∫•t v√† th·∫•p nh·∫•t
top_region = region_sales.loc[region_sales['sales'].idxmax()]
bottom_region = region_sales.loc[region_sales['sales'].idxmin()]

print("V√πng c√≥ DOANH THU CAO NH·∫§T:")
print(top_region)

print("\nV√πng c√≥ DOANH THU TH·∫§P NH·∫§T:")
print(bottom_region)

plt.figure(figsize=(10,5))
ax = sns.barplot(data=region_sales.sort_values('sales', ascending=False),
            x='region', y='sales', palette='Blues_d')

plt.title('T·ªïng doanh thu theo khu v·ª±c')
plt.xlabel('Khu v·ª±c')
plt.ylabel('T·ªïng doanh thu')
plt.grid(axis='y', linestyle='--', alpha=0.3)

for p in ax.patches:
    height = p.get_height()
    ax.text(
        x=p.get_x() + p.get_width()/2,
        y=height,s=f'{height/1000:.1f}K',ha='center',va='bottom',fontsize=10
    )

plt.tight_layout()
plt.show()

"""**C√≥ v√πng n√†o c√≥ Sales cao nh∆∞ng Profit Margin (%) th·∫•p kh√¥ng?**

**V√πng n√†o th·ª±c s·ª± kinh doanh hi·ªáu qu·∫£ nh·∫•t? (Bi√™n l·ª£i nhu·∫≠n %)**
"""

# ------ Profit Margin (%) cho t·ª´ng v√πng ------
# T√≠nh t·ªïng doanh thu v√† l·ª£i nhu·∫≠n theo v√πng
region_summary = df.groupby('region')[['sales', 'profit']].sum().reset_index()

# Th√™m c·ªôt bi√™n l·ª£i nhu·∫≠n (%)
region_summary['Profit Margin (%)'] = (region_summary['profit'] / region_summary['sales']) * 100

print(region_summary)

# ------ V√πng c√≥ bi√™n l·ª£i nhu·∫≠n cao nh·∫•t & th·∫•p nh·∫•t ------
top_margin = region_summary.loc[region_summary['Profit Margin (%)'].idxmax()]
bottom_margin = region_summary.loc[region_summary['Profit Margin (%)'].idxmin()]

print("\n V√πng c√≥ BI√äN L·ª¢I NHU·∫¨N (%) CAO NH·∫§T:")
print(top_margin)

print("\n V√πng c√≥ BI√äN L·ª¢I NHU·∫¨N (%) TH·∫§P NH·∫§T:")
print(bottom_margin)

# ------ Bi·ªÉu ƒë·ªì: Bi√™n l·ª£i nhu·∫≠n theo v√πng ------
plt.figure(figsize=(8,5))
ax = sns.barplot(data=region_summary.sort_values('Profit Margin (%)', ascending=False),
            x='region', y='Profit Margin (%)', palette='Greens_d')
plt.title('Bi√™n l·ª£i nhu·∫≠n (%) theo khu v·ª±c')
plt.xlabel('Khu v·ª±c')
plt.ylabel('Bi√™n l·ª£i nhu·∫≠n (%)')
plt.grid(axis='y', linestyle='--', alpha=0.3)

for p in ax.patches:
    height = p.get_height()
    ax.text(
        x=p.get_x() + p.get_width()/2,
        y=height,
        s=f'{height:.2f}%',ha='center',va='bottom',fontsize=10
    )
plt.tight_layout()
plt.show()

"""**V√πng c√≥ bi√™n l·ª£i nhu·∫≠n th·∫•p c√≥ ph·∫£i l√† ƒëang ch·ªãu l·ªó hay kh√¥ng?**"""

# L·ªçc c√°c d√≤ng c√≥ l·ª£i nhu·∫≠n √¢m v√† t√≠nh t·ªïng l·ªó theo t·ª´ng khu v·ª±c
negative_df = df[df["profit"] < 0]
region_loss = negative_df.groupby("region")["profit"].sum().sort_values()

# T·∫°o bi·ªÉu ƒë·ªì c·ªôt th·ªÉ hi·ªán m·ª©c l·ªó theo khu v·ª±c
plt.figure(figsize=(8,5))
bars = region_loss.plot(kind="bar", color="tomato")

plt.title("M·ª©c l·ªó theo khu v·ª±c")
plt.xlabel("Khu v·ª±c")
plt.ylabel("S·ªë ti·ªÅn l·ªó ($)")
plt.xticks(rotation=0)
plt.tight_layout()

# Th√™m nh√£n gi√° tr·ªã l√™n ƒë·∫ßu m·ªói c·ªôt
for i, value in enumerate(region_loss):
    plt.text(i, value, f'{value/1000:.1f}K', ha='center', va='bottom' if value > 0 else 'top', fontsize=10)

# ƒê·ªãnh d·∫°ng tr·ª•c tung theo ƒë∆°n v·ªã ngh√¨n ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n
plt.gca().yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x/1000:.0f}K'))
plt.show()

"""**Logistics t·∫°i khu v·ª±c trung t√¢m (central)**

Li·ªáu logistics c√≥ ph·∫£i l√† nguy√™n nh√¢n khi·∫øn khu v·ª±c trung t√¢m tr·ªü th√†nh khu v·ª±c thua l·ªó nhi·ªÅu nh·∫•t?

"""

# L·ªçc d·ªØ li·ªáu cho khu v·ª±c Trung T√¢m (Central)
central_df = df[df['region'] == 'Central'].copy()

fig, axes = plt.subplots(1, 2, figsize=(12,5))

# --- Ph·∫ßn 1: Ph√¢n b·ªë s·ªë ng√†y giao h√†ng t·∫°i khu v·ª±c Trung T√¢m ---
central_df['order_date'] = pd.to_datetime(central_df['order_date'])
central_df['ship_date'] = pd.to_datetime(central_df['ship_date'])
central_df['days_to_ship'] = (central_df['ship_date'] - central_df['order_date']).dt.days

days_counts = central_df['days_to_ship'].value_counts().sort_index()

sns.barplot(x=days_counts.index, y=days_counts.values, color='orchid', ax=axes[0])
axes[0].set_title("Ph√¢n b·ªë s·ªë ng√†y giao h√†ng t·∫°i khu v·ª±c Trung T√¢m", fontsize=12)
axes[0].set_xlabel('S·ªë ng√†y giao h√†ng')
axes[0].set_ylabel('S·ªë ƒë∆°n h√†ng')

# Th√™m nh√£n gi√° tr·ªã l√™n c·ªôt
for i, value in enumerate(days_counts.values):
    axes[0].text(i, value + 0.5, str(value), ha='center', va='bottom', fontsize=9)

# --- Ph·∫ßn 2: Ph√¢n b·ªë ph∆∞∆°ng th·ª©c giao h√†ng (bi·ªÉu ƒë·ªì tr√≤n) ---
ship_mode_counts = central_df['ship_mode'].value_counts()
axes[1].pie(
    ship_mode_counts.values,
    labels=ship_mode_counts.index,
    autopct='%1.1f%%',
    startangle=90,
    colors=plt.cm.Pastel1.colors
)
axes[1].set_title("T·ª∑ l·ªá ph∆∞∆°ng th·ª©c giao h√†ng t·∫°i khu v·ª±c Trung T√¢m", fontsize=12)

plt.tight_layout()
plt.show()

"""**Top 5 bang/th√†nh ph·ªë c√≥ doanh s·ªë cao nh·∫•t**"""

# Top 5 bang theo doanh s·ªë
state_sales = df.groupby('state', observed=False)['sales'].sum().reset_index()
top_5_state = state_sales.nlargest(5,'sales')

# Top 5 th√†nh ph·ªë theo doanh s·ªë
city_sales = df.groupby('city', observed=False)['sales'].sum().reset_index()
top_5_city = city_sales.nlargest(5,'sales')

# Define the format_sales function
def format_sales(value):
    """Formats a sales value into a human-readable string (e.g., 123.4K)"""
    return f'{value/1000:.1f}K'

# T·∫°o khung 2 bi·ªÉu ƒë·ªì c·∫°nh nhau
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# S·∫Øp x·∫øp d·ªØ li·ªáu gi·∫£m d·∫ßn
top_5_state = top_5_state.sort_values(by='sales', ascending=True)  # ngang, tƒÉng t·ª´ d∆∞·ªõi l√™n tr√™n
top_5_city = top_5_city.sort_values(by='sales', ascending=True)

# --- Bi·ªÉu ƒë·ªì 1: Top 5 States (ngang) ---
axes[0].barh(top_5_state['state'], top_5_state['sales'], color='steelblue')
axes[0].set_title('Top 5 Bang c√≥ doanh thu cao nh·∫•t', fontsize=13, fontweight='bold')
axes[0].set_xlabel('T·ªïng doanh thu ($)')
axes[0].set_ylabel('Ti·ªÉu bang')
axes[0].grid(axis='x', linestyle='--', alpha=0.4)

# Th√™m label tr√™n t·ª´ng thanh ngang
for i, v in enumerate(top_5_state['sales']):
    axes[0].text(v + (v * 0.01), i, format_sales(v),
                 va='center', ha='left', fontsize=9, color='black')

# --- Bi·ªÉu ƒë·ªì 2: Top 5 Cities (ngang) ---
axes[1].barh(top_5_city['city'], top_5_city['sales'], color='orange')
axes[1].set_title('Top 5 th√†nh ph·ªë c√≥ doanh thu cao nh·∫•t', fontsize=13, fontweight='bold')
axes[1].set_xlabel('T·ªïng doanh thu ($)')
axes[1].set_ylabel('Th√†nh ph·ªë')
axes[1].grid(axis='x', linestyle='--', alpha=0.4)

# Th√™m label tr√™n t·ª´ng thanh ngang
for i, v in enumerate(top_5_city['sales']):
    axes[1].text(v + (v * 0.01), i, format_sales(v),
                 va='center', ha='left', fontsize=9, color='black')

# CƒÉn ch·ªânh b·ªë c·ª•c cho ƒë·∫πp
plt.tight_layout()
plt.show()

"""**M·ª©c l·ªó theo c√°c ti·ªÉu bang (State)**"""

# T·∫°o danh s√°ch l·ª£i nhu·∫≠n theo bang (tƒÉng d·∫ßn)
state_loss = df.groupby("state", observed=False)["profit"].sum().sort_values()

# L·∫•y 15 bang c√≥ l·ª£i nhu·∫≠n th·∫•p nh·∫•t
least_profitable_states = state_loss.head(15)

# T·∫°o bi·ªÉu ƒë·ªì c·ªôt th·ªÉ hi·ªán 15 bang l·ªó nhi·ªÅu nh·∫•t
plt.figure(figsize=(12, 7))
colors = ["tomato" if val < 0 else "tab:blue" for val in least_profitable_states]
bars = least_profitable_states.plot(kind="bar", color=colors)

plt.title("Top 15 bang c√≥ l·ª£i nhu·∫≠n th·∫•p nh·∫•t")
plt.xlabel("Bang")
plt.ylabel("L·ª£i nhu·∫≠n ($)")
plt.xticks(rotation=45)

# Th√™m nh√£n gi√° tr·ªã l√™n t·ª´ng c·ªôt
for i, value in enumerate(least_profitable_states):
    plt.text(i, value + (least_profitable_states.max()*0.05 if value > 0 else least_profitable_states.min()*0.02), f'{value/1000:.2f}K',
             ha='center', va='bottom' if value > 0 else 'top', fontsize=9)

# ƒê·ªãnh d·∫°ng tr·ª•c tung theo ƒë∆°n v·ªã ngh√¨n (K)
plt.gca().yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x/1000:.0f}K'))

plt.tight_layout()
plt.show()

"""NH·∫¨N X√âT

Khi xem x√©t 5 bang c√≥ doanh s·ªë cao nh·∫•t, ch√∫ng ta th·∫•y Texas - bang c√≥ l·ª£i nhu·∫≠n th·∫•p th·ª© ba. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√†, m·∫∑c d√π Texas c√≥ doanh s·ªë l·ªõn, nh∆∞ng v·∫´n ƒëang ch·ªãu l·ªó. T∆∞∆°ng t·ª± nh∆∞ khu v·ª±c Trung t√¢m, nguy√™n nh√¢n g√¢y thua l·ªó t·∫°i Texas c√≥ th·ªÉ l√† do ch√≠nh s√°ch chi·∫øt kh·∫•u ch∆∞a h·ª£p l√Ω.

**M·ª©c chi·∫øt kh·∫•u theo doanh s·ªë v√† nh√≥m s·∫£n ph·∫©m t·∫°i Texas**
"""

texas_df = df[df['state'] == 'Texas']

# Aggregate Sales, Profit and Avg Discount by Sub-Category
subcat_summary = texas_df.groupby('sub_category').agg({
    'sales':'sum',
    'profit':'sum',
    'discount':'mean'
}).reset_index()

# --- Bi·ªÉu ƒë·ªì: So s√°nh doanh s·ªë v√† l·ª£i nhu·∫≠n theo nh√≥m s·∫£n ph·∫©m t·∫°i Texas ---

# top 10 Sub-Categories by Sales (Included from cell xmEIMZehPzXs)
top10_subcat = (texas_df.groupby('sub_category', observed=False)
    .agg({'sales': 'sum', 'profit': 'sum', 'discount': 'mean'})
    .reset_index()
    .sort_values(by='sales', ascending=False)
    .head(10))

x = top10_subcat['sub_category']
bar_width = 0.4
x_idx = range(len(x))

plt.figure(figsize=(10,5))

# V·∫Ω 2 c·ªôt c·∫°nh nhau (Sales & Profit) and assign them to variables
bars_sales = plt.bar([i - bar_width/2 for i in x_idx], top10_subcat['sales'],
        width=bar_width, color='orchid', label='Doanh s·ªë')
bars_profit = plt.bar([i + bar_width/2 for i in x_idx], top10_subcat['profit'],
        width=bar_width, color='tab:blue', label='L·ª£i nhu·∫≠n')

# C√†i ƒë·∫∑t tr·ª•c v√† nh√£n
plt.xticks(x_idx, x, rotation=45, ha='right')
plt.ylabel("Gi√° tr·ªã ($)")
plt.title("Top 10 nh√≥m s·∫£n ph·∫©m: Doanh s·ªë v√† l·ª£i nhu·∫≠n t·∫°i Texas")
plt.legend()

# ƒê·ªãnh d·∫°ng tr·ª•c tung theo ƒë∆°n v·ªã ngh√¨n
plt.gca().yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x/1000:.0f}K'))

# Add label on Sales bars
for bar in bars_sales:
    height = bar.get_height()
    plt.text(
        bar.get_x() + bar.get_width()/2,
        height + max(top10_subcat['sales'])*0.01,
        f'{height/1000:.0f}K',ha='center',va='bottom',fontsize=9
    )

# Add label on Profit bars
for bar in bars_profit:
    height = bar.get_height()
    # Adjust vertical alignment for negative profit values
    va = 'bottom' if height >= 0 else 'top'
    plt.text(
        bar.get_x() + bar.get_width()/2,
        height + np.sign(height)*max(abs(top10_subcat['profit']))*0.01, # Add a small offset
        f'{height/1000:.0f}K',
        ha='center',
        va=va,
        fontsize=9
    )

plt.tight_layout()
plt.show()

# --- Bi·ªÉu ƒë·ªì scatter: Chi·∫øt kh·∫•u trung b√¨nh c·ªßa 10 nh√≥m s·∫£n ph·∫©m b√°n ch·∫°y nh·∫•t t·∫°i Texas ---

# top 10 Sub-Categories by Sales
top10_subcat = (texas_df.groupby('sub_category')
    .agg({'sales': 'sum', 'profit': 'sum', 'discount': 'mean'})
    .reset_index()
    .sort_values(by='sales', ascending=False)
    .head(10))

plt.figure(figsize=(8,5))
sns.scatterplot(
    data=top10_subcat,
    x='sub_category',
    y='discount',
    s=120,
    color='tomato'
)

plt.title("Chi·∫øt kh·∫•u trung b√¨nh c·ªßa 10 nh√≥m s·∫£n ph·∫©m b√°n ch·∫°y nh·∫•t t·∫°i Texas", fontsize=15)
plt.xlabel("Nh√≥m s·∫£n ph·∫©m")
plt.ylabel("Chi·∫øt kh·∫•u trung b√¨nh (%)")
plt.xticks(rotation=45, ha='right')

plt.tight_layout()
plt.show()

"""Khi xem x√©t c√°c bi·ªÉu ƒë·ªì c√πng nhau, ta c√≥ th·ªÉ hi·ªÉu r√µ h∆°n l√Ω do t·∫°i sao bang Texas ‚Äî m·∫∑c d√π c√≥ *doanh s·ªë ƒë·ª©ng th·ª© ba* to√†n qu·ªëc nh∆∞ng l·∫°i l√† bang c√≥ *l·ª£i nhu·∫≠n th·∫•p nh·∫•t*.

* Top 10 nh√≥m s·∫£n ph·∫©m theo Doanh s·ªë v√† L·ª£i nhu·∫≠n t·∫°i Texas:
G·∫ßn nh∆∞ to√†n b·ªô c√°c nh√≥m s·∫£n ph·∫©m b√°n ch·∫°y nh·∫•t ·ªü Texas ƒë·ªÅu c√≥ l·ª£i nhu·∫≠n √¢m, nghƒ©a l√† nh·ªØng s·∫£n ph·∫©m ƒë·ªÅu mang l·∫°i doanh thu cao th·ª±c ch·∫•t l·∫°i ƒëang g√¢y thua l·ªó.

* Chi·∫øt kh·∫•u trung b√¨nh c·ªßa Top 10 nh√≥m s·∫£n ph·∫©m t·∫°i Texas:
Ph·∫ßn l·ªõn c√°c nh√≥m s·∫£n ph·∫©m b·ªã l·ªó ƒë·ªÅu c√≥ m·ª©c chi·∫øt kh·∫•u trung b√¨nh cao, trong ƒë√≥ nh√≥m thua l·ªó n·∫∑ng nh·∫•t c≈©ng l√† nh√≥m c√≥ chi·∫øt kh·∫•u cao nh·∫•t.

K·∫æT LU·∫¨N:
Nguy√™n nh√¢n ch√≠nh khi·∫øn Texas c√≥ l·ª£i nhu·∫≠n th·∫•p, d√π doanh s·ªë m·∫°nh, l√† do ch√≠nh s√°ch gi·∫£m gi√° qu√° m·∫°nh ƒë·ªëi v·ªõi c√°c s·∫£n ph·∫©m b√°n ch·∫°y.
M·ª©c chi·∫øt kh·∫•u cao ƒë√£ l√†m gi·∫£m bi√™n l·ª£i nhu·∫≠n, khi·∫øn doanh s·ªë tƒÉng nh∆∞ng l·ª£i nhu·∫≠n t·ªïng th·ªÉ l·∫°i s·ª•t gi·∫£m ƒë√°ng k·ªÉ.

### 3.6. Ph√¢n t√≠ch theo danh m·ª•c s·∫£n ph·∫©m (Category)
"""

# So s√°nh hi·ªáu qu·∫£ kinh doanh gi·ªØa c√°c danh m·ª•c s·∫£n ph·∫©m
sales_furniture = df.loc[df['category']=='Furniture','sales'].sum()
sales_office = df.loc[df['category']=='Office Supplies','sales'].sum()
sales_technology = df.loc[df['category']=='Technology','sales'].sum()

print('Doanh s·ªë - N·ªôi th·∫•t:', sales_furniture)
print('Doanh s·ªë - VƒÉn ph√≤ng ph·∫©m:', sales_office)
print('Doanh s·ªë - C√¥ng ngh·ªá:', sales_technology)

profit_furniture=df.loc[df['category']=='Furniture','profit'].sum()
profit_office=df.loc[df['category']=='Office Supplies','profit'].sum()
profit_technology=df.loc[df['category']=='Technology','profit'].sum()

print(20*'-')

print('L·ª£i nhu·∫≠n - N·ªôi th·∫•t:', profit_furniture)
print('L·ª£i nhu·∫≠n - VƒÉn ph√≤ng ph·∫©m:', profit_office)
print('L·ª£i nhu·∫≠n - C√¥ng ngh·ªá:', profit_technology)

# --- Bi·ªÉu ƒë·ªì: T·ªïng doanh thu v√† l·ª£i nhu·∫≠n theo danh m·ª•c s·∫£n ph·∫©m ---

fig, ax = plt.subplots(1, 2, figsize=(10, 5))
colors = ['lightblue', 'orange', 'lightgreen']

# --- Bi·ªÉu ƒë·ªì 1: T·ªïng doanh thu theo danh m·ª•c ---
ax[0].pie(
    [sales_furniture, sales_office, sales_technology],
    labels=['Furniture', 'Office', 'Technology'],
    colors=colors,
    autopct='%1.1f%%'
)
ax[0].set_title('T·ªïng doanh thu theo danh m·ª•c s·∫£n ph·∫©m')

# --- Bi·ªÉu ƒë·ªì 2: T·ªïng l·ª£i nhu·∫≠n theo danh m·ª•c ---
ax[1].pie(
    [profit_furniture, profit_office, profit_technology],
    labels=['Furniture', 'Office', 'Technology'],
    colors=colors,
    autopct='%1.1f%%',
    explode=[0.3, 0, 0]
)
ax[1].set_title('T·ªïng l·ª£i nhu·∫≠n theo danh m·ª•c s·∫£n ph·∫©m')
plt.tight_layout()
plt.show()

"""**Bi√™n l·ª£i nhu·∫≠n theo t·ª´ng danh m·ª•c**"""

# --- T√≠nh Profit Margin (%) theo Category ---
category_profit = df.groupby('category', observed=False)[['sales', 'profit']].sum().reset_index()
category_profit['Profit Margin (%)'] = (category_profit['profit'] / category_profit['sales']) * 100

# --- V·∫Ω bi·ªÉu ƒë·ªì ---
plt.figure(figsize=(8,5))
bars = plt.bar(category_profit['category'], category_profit['Profit Margin (%)'], color='skyblue')
plt.title('Bi√™n l·ª£i nhu·∫≠n (%) theo danh m·ª•c s·∫£n ph·∫©m')
plt.xlabel('Danh m·ª•c s·∫£n ph·∫©m')
plt.ylabel('Bi√™n l·ª£i nhu·∫≠n (%)')
plt.grid(axis='y', linestyle='--', alpha=0.3)

for bar in bars:
    height = bar.get_height()
    plt.text(
        x=bar.get_x() + bar.get_width()/2,
        y=height,
        s=f'{height:.1f}%', ha='center', va='bottom', fontsize=10
    )

plt.tight_layout()
plt.show()

"""NH·∫¨N X√âT
* Danh m·ª•c c√≥ √≠t l·ª£i nhu·∫≠n nh·∫•t l√† ƒê·ªì n·ªôi th·∫•t (Furniture).

**Danh m·ª•c n√†o mang l·∫°i doanh thu cao nh·∫•t/th·∫•p nh·∫•t tr√™n t·ª´ng khu v·ª±c?**
"""

# T√≠nh t·ªïng doanh thu theo khu v·ª±c v√† danh m·ª•c
region_category_sales = df.groupby(['region', 'category'])['sales'].sum().reset_index()
# T√¨m danh m·ª•c c√≥ doanh thu cao nh·∫•t / th·∫•p nh·∫•t tr√™n m·ªói khu v·ª±c
max_sales = region_category_sales.loc[region_category_sales.groupby('region')['sales'].idxmax()]
min_sales = region_category_sales.loc[region_category_sales.groupby('region')['sales'].idxmin()]

print("Danh m·ª•c c√≥ DOANH THU CAO NH·∫§T tr√™n t·ª´ng khu v·ª±c:")
print(max_sales)
print("\n Danh m·ª•c c√≥ DOANH THU TH·∫§P NH·∫§T tr√™n t·ª´ng khu v·ª±c:")
print(min_sales)

# --- Bi·ªÉu ƒë·ªì ---
plt.figure(figsize=(10,6))
ax = sns.barplot(data=region_category_sales, x='region', y='sales', hue='category', palette='Blues')
plt.title('T·ªïng doanh s·ªë theo danh m·ª•c s·∫£n ph·∫©m t·∫°i t·ª´ng khu v·ª±c', fontsize=20)
plt.ylabel('T·ªïng doanh s·ªë')
plt.xlabel('Khu v·ª±c')
plt.legend(title='Danh m·ª•c s·∫£n ph·∫©m')
plt.grid(axis='y', linestyle='--', alpha=0.3)

for p in ax.patches:
    height = p.get_height()
    ax.text(
        x=p.get_x() + p.get_width()/2,
        y=height + max(region_category_sales['sales'])*0.01,
        s=f'{height/1000:.1f}K',ha='center',va='bottom',fontsize=10
    )

plt.tight_layout()
plt.show()

"""**T·∫°i sao ƒë·ªì n·ªôi th·∫•t (Furniture) mang l·∫°i doanh thu kh√° cao g·∫ßn b·∫±ng 2 nh√≥m h√†ng c√≤n l·∫°i nh∆∞ng l·ª£i nhu·∫≠n c√≥ ƒë∆∞·ª£c l·∫°i r·∫•t th·∫•p?**

**L·ª£i nhu·∫≠n theo c√°c ti·ªÉu m·ª•c (sub-category)**
"""

# T√≠nh to√°n l·ª£i nhu·∫≠n
profit_subcat = df.groupby("sub_category", observed=True)["profit"].sum().reset_index().sort_values(by="profit", ascending=False)

order_list = profit_subcat['sub_category']

# --- Bi·ªÉu ƒë·ªì: T·ªïng l·ª£i nhu·∫≠n theo nh√≥m h√†ng ph·ª• ---
import matplotlib.colors as mcolors

plt.figure(figsize=(13,8))

rgb_color_tuple = sns.color_palette("ocean", as_cmap=False)[0]
color_positive_hex = mcolors.to_hex(rgb_color_tuple)
color_negative = "firebrick"
bar_colors = np.where(
    profit_subcat['profit'] >= 0,
    color_positive_hex,
    color_negative
)

ax = sns.barplot(data=profit_subcat, x='sub_category', y='profit',
            order=order_list, palette = bar_colors)
plt.xticks(rotation=45)
plt.title('L·ª£i nhu·∫≠n theo danh m·ª•c ph·ª•', fontsize=20)
plt.xlabel('Danh m·ª•c ph·ª•',fontsize=10)
plt.ylabel('T·ªïng l·ª£i nhu·∫≠n',fontsize=10)
plt.axhline(0, color='grey', linewidth=0.8)

for p in ax.patches:
    height = p.get_height()
    ax.text(
        x=p.get_x() + p.get_width()/2,
        y=height + np.sign(height)*max(abs(profit_subcat['profit']))*0.01,
        s=f'{height/1000:.1f}K',
        ha='center',
        va='bottom' if height >= 0 else 'top',
        fontsize=10
    )
plt.show()

# --- Top 3 danh m·ª•c ph·ª• c√≥ l·ª£i nhu·∫≠n cao nh·∫•t ---
top3_high_profit = profit_subcat.sort_values(by='profit', ascending=False).head(3)
print("Top 3 danh m·ª•c ph·ª• c√≥ l·ª£i nhu·∫≠n cao nh·∫•t:")
print(top3_high_profit)

# --- Top 3 danh m·ª•c ph·ª• c√≥ l·ª£i nhu·∫≠n th·∫•p nh·∫•t ---
top3_low_profit = profit_subcat.sort_values(by='profit', ascending=True).head(3)
print("\nTop 3 danh m·ª•c ph·ª• c√≥ l·ª£i nhu·∫≠n th·∫•p nh·∫•t:")
print(top3_low_profit)

"""NH·∫¨N X√âT

üîπ Top 3 nh√≥m c√≥ l·ª£i nhu·∫≠n cao nh·∫•t:

* Copiers (M√°y photocopy) ƒë·∫°t l·ª£i nhu·∫≠n cao nh·∫•t, h∆°n 55.000 USD, cho th·∫•y ƒë√¢y l√† s·∫£n ph·∫©m mang l·∫°i gi√° tr·ªã kinh t·∫ø l·ªõn, c√≥ th·ªÉ nh·ªù bi√™n l·ª£i nhu·∫≠n cao ho·∫∑c nhu c·∫ßu ·ªïn ƒë·ªãnh.

* Phones (ƒêi·ªán tho·∫°i) v√† Accessories (Ph·ª• ki·ªán) c≈©ng c√≥ l·ª£i nhu·∫≠n t·ªët, l·∫ßn l∆∞·ª£t kho·∫£ng 44.500 USD v√† 41.900 USD, ch·ª©ng t·ªè nh√≥m s·∫£n ph·∫©m c√¥ng ngh·ªá v√† vƒÉn ph√≤ng l√† ngu·ªìn l·ª£i nhu·∫≠n ch√≠nh.

üîª Top 3 nh√≥m c√≥ l·ª£i nhu·∫≠n th·∫•p nh·∫•t:

* Tables (B√†n) g√¢y l·ªó n·∫∑ng nh·∫•t, g·∫ßn ‚Äì17.700 USD, cho th·∫•y kh·∫£ nƒÉng ƒë·ªãnh gi√°, chi·∫øt kh·∫•u ho·∫∑c chi ph√≠ v·∫≠n chuy·ªÉn/s·∫£n xu·∫•t c√≥ v·∫•n ƒë·ªÅ.

* Bookcases (Gi√° s√°ch) v√† Supplies (V·∫≠t t∆∞) c≈©ng ghi nh·∫≠n l·ªó nh·∫π, d∆∞·ªõi ‚Äì3.500 USD, tuy kh√¥ng nghi√™m tr·ªçng b·∫±ng nh∆∞ng v·∫´n c·∫ßn xem x√©t ƒë·ªÉ c·∫£i thi·ªán.

**K·∫æT LU·∫¨N:**
Doanh nghi·ªáp ƒëang ph·ª• thu·ªôc ph·∫ßn l·ªõn v√†o nh√≥m s·∫£n ph·∫©m c√¥ng ngh·ªá (Copiers, Phones, Accessories) ƒë·ªÉ t·∫°o l·ª£i nhu·∫≠n, trong khi nh√≥m n·ªôi th·∫•t (Tables, Bookcases) l·∫°i l√† ƒëi·ªÉm y·∫øu c·∫ßn ƒë∆∞·ª£c ƒë√°nh gi√° l·∫°i v·ªÅ gi√° b√°n, chi·∫øt kh·∫•u ho·∫∑c c·∫•u tr√∫c chi ph√≠.

**Chi·∫øt kh·∫•u theo ti·ªÉu m·ª•c (Sub-Category)**
"""

# --- Bi·ªÉu ƒë·ªì: So s√°nh chi·∫øt kh·∫•u trung b√¨nh c√≥ tr·ªçng s·ªë theo nh√≥m s·∫£n ph·∫©m ---

# T√≠nh chi·∫øt kh·∫•u trung b√¨nh c√≥ tr·ªçng s·ªë (theo doanh s·ªë) cho t·ª´ng nh√≥m s·∫£n ph·∫©m
weighted_discount = (
    df.groupby("sub_category")[["discount", "sales"]]
    .apply(lambda x: (x["discount"] * x["sales"]).sum() / x["sales"].sum())
    .sort_values()
)

# T√≠nh chi·∫øt kh·∫•u trung b√¨nh c√≥ tr·ªçng s·ªë cho to√†n b·ªô s·∫£n ph·∫©m
overall_weighted_avg = (df["discount"] * df["sales"]).sum() / df["sales"].sum()

# V·∫Ω bi·ªÉu ƒë·ªì
plt.figure(figsize=(10,5))

# ƒê∆∞·ªùng g·∫°ch ngang bi·ªÉu th·ªã chi·∫øt kh·∫•u trung b√¨nh to√†n b·ªô
plt.axhline(overall_weighted_avg, color='black', linestyle='--', label='Chi·∫øt kh·∫•u TB to√†n b·ªô')

# C√°c ƒëi·ªÉm bi·ªÉu di·ªÖn chi·∫øt kh·∫•u t·ª´ng nh√≥m s·∫£n ph·∫©m
plt.scatter(weighted_discount.index, weighted_discount.values, color='gray', s=60)

# T√¥ ƒë·ªè nh√≥m ‚ÄúTables‚Äù ƒë·ªÉ l√†m n·ªïi b·∫≠t
plt.scatter('Tables', weighted_discount['Tables'], color='tomato', s=120, label='Tables')

# C√†i ƒë·∫∑t bi·ªÉu ƒë·ªì
plt.title("Chi·∫øt kh·∫•u trung b√¨nh c√≥ tr·ªçng s·ªë theo nh√≥m s·∫£n ph·∫©m", fontsize=14)
plt.ylabel("Chi·∫øt kh·∫•u trung b√¨nh c√≥ tr·ªçng s·ªë")
plt.xticks(rotation=45, ha='right')
plt.legend(loc='lower right')

plt.tight_layout()
plt.show()

"""NH·∫¨N X√âT

* Bi·ªÉu ƒë·ªì c·ªßng c·ªë nh·∫≠n ƒë·ªãnh r·∫±ng ch√≠nh s√°ch chi·∫øt kh·∫•u qu√° cao ƒë·ªëi v·ªõi nh√≥m **Tables** l√† nguy√™n nh√¢n tr·ª±c ti·∫øp khi·∫øn nh√≥m n√†y b·ªã l·ªó. Doanh nghi·ªáp c·∫ßn xem x√©t l·∫°i chi·∫øn l∆∞·ª£c gi√° ho·∫∑c ch√≠nh s√°ch khuy·∫øn m√£i cho s·∫£n ph·∫©m n√†y ƒë·ªÉ c·∫£i thi·ªán hi·ªáu qu·∫£ kinh doanh.

### 3.7. Theo chi·∫øt kh·∫•u v√† hi·ªáu qu·∫£ ƒë∆°n h√†ng

**Khi chi·∫øt kh·∫•u l·ªõn h∆°n 20% (discount > 0.2), t·ªâ l·ªá ƒë∆°n h√†ng l·ªó tƒÉng m·∫°nh kh√¥ng?**
"""

# Th√™m c·ªôt order_loss: 1 n·∫øu profit < 0, 0 n·∫øu profit >=0
df['order_loss'] = (df['profit'] < 0).astype(int)

# Nh√≥m theo bins c·ªßa discount ƒë·ªÉ d·ªÖ quan s√°t xu h∆∞·ªõng
discount_bins = np.arange(0, df['discount'].max() + 0.05, 0.05)  # chia discount m·ªói 5%
df['discount_bin'] = pd.cut(df['discount'], bins=discount_bins)

# T√≠nh t·ª∑ l·ªá ƒë∆°n h√†ng l·ªó trong m·ªói bin
loss_rate = df.groupby('discount_bin', observed=False)['order_loss'].mean().reset_index()

# Convert the discount_bin to string for plotting
loss_rate['discount_bin'] = loss_rate['discount_bin'].astype(str)

# V·∫Ω bi·ªÉu ƒë·ªì
plt.figure(figsize=(10,5))
sns.lineplot(x='discount_bin', y='order_loss', data=loss_rate, marker='o')
plt.xticks(rotation=45)
plt.xlabel('Chi·∫øt kh·∫•u')
plt.ylabel('T·ª∑ l·ªá ƒë∆°n h√†ng l·ªó')
plt.title('T·ª∑ l·ªá ƒë∆°n h√†ng l·ªó theo m·ª©c chi·∫øt kh·∫•u')
plt.grid(True, linestyle='--', alpha=0.3)
plt.show()

"""NH·∫¨N X√âT
* Khi m·ª©c chi·∫øt kh·∫•u d∆∞·ªõi 0.2, t·ª∑ l·ªá ƒë∆°n h√†ng l·ªó c√≤n th·∫•p, dao ƒë·ªông quanh kh√∫c 0‚Äì30%, nghƒ©a l√† ph·∫ßn l·ªõn c√°c ƒë∆°n h√†ng ·ªü m·ª©c gi·∫£m gi√° nh·∫π v·∫´n c√≥ l·ª£i nhu·∫≠n.

* Tuy nhi√™n, t·ª´ m·ª©c chi·∫øt kh·∫•u 0.25 tr·ªü l√™n, t·ª∑ l·ªá ƒë∆°n h√†ng l·ªó tƒÉng m·∫°nh, v∆∞·ª£t 90%, v√† ƒë·∫°t 100% ·ªü nhi·ªÅu kho·∫£ng chi·∫øt kh·∫•u cao h∆°n (t·ª´ 0.3 tr·ªü ƒëi).

* ƒêi·ªÅu n√†y cho th·∫•y m·ª©c gi·∫£m gi√° c√†ng cao th√¨ kh·∫£ nƒÉng thua l·ªó c√†ng l·ªõn, ƒë·∫∑c bi·ªát khi chi·∫øt kh·∫•u v∆∞·ª£t qu√° 25%.

**K·∫øt lu·∫≠n:**
Bi·ªÉu ƒë·ªì kh·∫≥ng ƒë·ªãnh r·∫±ng chi·∫øt kh·∫•u l√† y·∫øu t·ªë ·∫£nh h∆∞·ªüng tr·ª±c ti·∫øp ƒë·∫øn l·ª£i nhu·∫≠n.
Ch√≠nh s√°ch gi·∫£m gi√° qu√° s√¢u (tr√™n 25%) g·∫ßn nh∆∞ ƒë·∫£m b·∫£o thua l·ªó, do gi√° b√°n kh√¥ng ƒë·ªß b√π ƒë·∫Øp chi ph√≠. Doanh nghi·ªáp n√™n ki·ªÉm so√°t ng∆∞·ª°ng chi·∫øt kh·∫•u, ch·ªâ √°p d·ª•ng gi·∫£m gi√° l·ªõn cho s·∫£n ph·∫©m c√≥ bi√™n l·ª£i nhu·∫≠n cao ho·∫∑c c·∫ßn x·∫£ h√†ng t·ªìn

**Bi√™n l·ª£i nhu·∫≠n trung b√¨nh theo discount**
- C√≥ ng∆∞·ª°ng chi·∫øt kh·∫•u n√†o l√†m bi√™n l·ª£i nhu·∫≠n gi·∫£m s√¢u?
"""

# T√≠nh bi√™n l·ª£i nhu·∫≠n = profit / sales
df['profit_margin'] = df['profit'] / df['sales']

# Trung b√¨nh bi√™n l·ª£i nhu·∫≠n theo bin discount
margin_by_discount = df.groupby('discount_bin', observed=False)['profit_margin'].mean().reset_index()

# Convert the discount_bin to string for plotting
margin_by_discount['discount_bin'] = margin_by_discount['discount_bin'].astype(str)

# V·∫Ω bi·ªÉu ƒë·ªì
plt.figure(figsize=(10,5))
sns.lineplot(x='discount_bin', y='profit_margin', data=margin_by_discount, marker='o', color='orange')
plt.xticks(rotation=45)
plt.xlabel('Chi·∫øt kh·∫•u')
plt.ylabel('Bi√™n l·ª£i nhu·∫≠n trung b√¨nh')
plt.title('Bi√™n l·ª£i nhu·∫≠n theo m·ª©c chi·∫øt kh·∫•u')
plt.grid(True, linestyle='--', alpha=0.3)
plt.show()

"""NH·∫¨N X√âT

* Bi·ªÉu ƒë·ªì cho th·∫•y chi·∫øt kh·∫•u c√†ng cao th√¨ bi√™n l·ª£i nhu·∫≠n c√†ng gi·∫£m r√µ r·ªát. c√≥ th·ªÉ th·∫•y ·ªü m·ª©c chi·∫øt kh·∫•u th·∫•p (d∆∞·ªõi 0.2), bi√™n l·ª£i nhu·∫≠n v·∫´n d∆∞∆°ng, t·ª©c l√† doanh nghi·ªáp v·∫´n ƒë·∫°t l√£i nh·∫π
* Khi chi·∫øt kh·∫•u v∆∞·ª£t 20‚Äì25%, l·ª£i nhu·∫≠n b·∫Øt ƒë·∫ßu √¢m v√† gi·∫£m s√¢u m·∫°nh ·ªü m·ª©c tr√™n 0.6

ƒê√≠nh h∆∞·ªõng doanh nghi·ªáp n√™n gi·ªõi h·∫°n m·ª©c chi·∫øt kh·∫•u, t·ªëi ∆∞u chi·∫øn l∆∞·ª£c khuy·∫øn m√£i - thay v√¨ gi·∫£m gi√° tr·ª±c ti·∫øp, c√≥ th·ªÉ √°p d·ª•ng qu√† t·∫∑ng ho·∫∑c g√≥i d·ªãch v·ª• gi√° tr·ªã gia tƒÉng ƒë·ªÉ b·∫£o to√†n l·ª£i nhu·∫≠n

### 3.8. Ph√¢n t√≠ch theo ph√¢n kh√∫c kh√°ch h√†ng

**Ph√¢n kh√∫c kh√°ch h√†ng n√†o chi·∫øm t·ª∑ tr·ªçng l·ªõn**
"""

# T√≠nh t·ªïng doanh thu theo ph√¢n kh√∫c kh√°ch h√†ng
segment_sales = df.groupby('segment')['sales'].sum().reset_index()

# T√≠nh t·ª∑ tr·ªçng (%)
segment_sales['sales_pct'] = 100 * segment_sales['sales'] / segment_sales['sales'].sum()

# S·∫Øp x·∫øp gi·∫£m d·∫ßn ƒë·ªÉ bi·∫øt ph√¢n kh√∫c chi·∫øm t·ª∑ tr·ªçng l·ªõn nh·∫•t
segment_sales = segment_sales.sort_values(by='sales', ascending=False)

print("T·ª∑ tr·ªçng doanh thu theo ph√¢n kh√∫c kh√°ch h√†ng:")
print(segment_sales)

segment_sales = df.groupby('segment')['sales'].sum().reset_index()
segment_sales['sales_pct'] = 100 * segment_sales['sales'] / segment_sales['sales'].sum()
segment_sales = segment_sales.sort_values(by='sales', ascending=False)

# --- V·∫Ω pie chart ---
plt.figure(figsize=(6,6))
colors = sns.color_palette('Blues_r', len(segment_sales))
plt.pie(segment_sales['sales_pct'], labels=segment_sales['segment'],
        autopct='%1.1f%%', startangle=90, colors=colors)
plt.title('T·ª∑ tr·ªçng doanh thu theo ph√¢n kh√∫c kh√°ch h√†ng')
plt.show()

"""**Top 10 kh√°ch h√†ng ƒë√≥ng g√≥p doanh thu / l·ª£i nhu·∫≠n cao nh·∫•t**"""

# Top 10 kh√°ch h√†ng theo doanh thu
top10_customers_sales = df.groupby('customer_name')['sales'].sum().sort_values(ascending=False).head(10)
print("Top 10 kh√°ch h√†ng theo doanh thu:")
print(top10_customers_sales)

# Top 10 kh√°ch h√†ng theo l·ª£i nhu·∫≠n
top10_customers_profit = df.groupby('customer_name')['profit'].sum().sort_values(ascending=False).head(10)
print("\nTop 10 kh√°ch h√†ng theo l·ª£i nhu·∫≠n:")
print(top10_customers_profit)

top10_customers_sales = df.groupby('customer_name')['sales'].sum().sort_values(ascending=False).head(10).reset_index()
top10_customers_profit = df.groupby('customer_name')['profit'].sum().sort_values(ascending=False).head(10).reset_index()

# --- V·∫Ω bi·ªÉu ƒë·ªì ---
fig, axes = plt.subplots(1, 2, figsize=(16,6))

# Bi·ªÉu ƒë·ªì 1: Top 10 kh√°ch h√†ng theo doanh thu
sns.barplot(x='sales', y='customer_name', data=top10_customers_sales, palette='Greens_r', ax=axes[0])
axes[0].set_title('Top 10 kh√°ch h√†ng theo doanh thu')
axes[0].set_xlabel('Doanh thu')
axes[0].set_ylabel('Kh√°ch h√†ng')

# Bi·ªÉu ƒë·ªì 2: Top 10 kh√°ch h√†ng theo l·ª£i nhu·∫≠n
sns.barplot(x='profit', y='customer_name', data=top10_customers_profit, palette='Oranges_r', ax=axes[1])
axes[1].set_title('Top 10 kh√°ch h√†ng theo l·ª£i nhu·∫≠n')
axes[1].set_xlabel('L·ª£i nhu·∫≠n')
axes[1].set_ylabel('Kh√°ch h√†ng')

plt.tight_layout()
plt.show()

"""**H√†nh vi mua h√†ng**"""

# Ph√¢n t√≠ch th·ªùi ƒëi·ªÉm mua h√†ng (theo th√°ng)
monthly_orders = df.groupby('month_order')['order_id'].nunique()
plt.figure(figsize=(10,5))
sns.lineplot(x=monthly_orders.index, y=monthly_orders.values, marker='o')
plt.title('T·∫ßn su·∫•t mua h√†ng theo th√°ng', fontsize=14)
plt.xlabel('Th√°ng')
plt.ylabel('S·ªë l∆∞·ª£ng ƒë∆°n h√†ng')
plt.grid(True)
plt.show()

# Ph√¢n t√≠ch m·ª©c chi·∫øt kh·∫•u ∆∞a th√≠ch c·ªßa kh√°ch h√†ng
discount_pref = df.groupby('customer_id')['discount'].mean().reset_index()
plt.figure(figsize=(8,5))
sns.histplot(discount_pref['discount'], bins=30, kde=True, color='teal')
plt.title('Ph√¢n b·ªë m·ª©c chi·∫øt kh·∫•u trung b√¨nh kh√°ch h√†ng nh·∫≠n ƒë∆∞·ª£c', fontsize=14)
plt.xlabel('M·ª©c chi·∫øt kh·∫•u trung b√¨nh')
plt.ylabel('S·ªë kh√°ch h√†ng')
plt.show()

"""### 3.9. Ph√¢n t√≠ch theo logistic (Ship Mode / Shipping Time)

**Ship Mode n√†o ph·ªï bi·∫øn nh·∫•t?**
"""

shipmode_count = df['ship_mode'].value_counts().reset_index()
shipmode_count.columns = ['ship_mode', 'order_count']

print("S·ªë l∆∞·ª£ng ƒë∆°n h√†ng theo Ship Mode:")
print(shipmode_count)

plt.figure(figsize=(6,5))
ax = sns.barplot(x='ship_mode', y='order_count', data=shipmode_count, palette='Blues_r')
plt.title('S·ªë l∆∞·ª£ng ƒë∆°n h√†ng theo Ship Mode')
plt.xlabel('Ship Mode')
plt.ylabel('S·ªë l∆∞·ª£ng ƒë∆°n h√†ng')
for p in ax.patches:
    height = p.get_height()
    ax.text(x=p.get_x() + p.get_width()/2,
            y=height + 1,
            s=int(height), ha='center')
plt.show()

"""**Ship Mode c√≥ th·ªùi gian giao h√†ng trung b√¨nh nhanh nh·∫•t?**"""

avg_shipping_time = df.groupby('ship_mode')['shipping_time'].mean().reset_index().sort_values(by='shipping_time')

print("Th·ªùi gian giao h√†ng trung b√¨nh theo Ship Mode:")
print(avg_shipping_time)

plt.figure(figsize=(6,5))
ax = sns.barplot(x='ship_mode', y='shipping_time', data=avg_shipping_time, palette='Blues_r')
plt.title('Th·ªùi gian giao h√†ng trung b√¨nh theo Ship Mode')
plt.xlabel('Ship Mode')
plt.ylabel('Th·ªùi gian giao h√†ng trung b√¨nh (ng√†y)')
for p in ax.patches:
    height = p.get_height()
    ax.text(x=p.get_x() + p.get_width()/2,
            y=height + 0.1,
            s=f'{height:.2f}', ha='center')
plt.show()

"""### 3.10. H·ªá s·ªë t∆∞∆°ng quan gi·ªØa c√°c y·∫øu t·ªë"""

# ƒê·∫∑t t√™n c·ªôt d·ªÖ nh√¨n
df_rename = df.rename(columns={
    'sales': 'Doanh thu',
    'discount': 'Chi·∫øt kh·∫•u',
    'profit': 'L·ª£i nhu·∫≠n',
    'cost': 'Chi ph√≠',
    'profit_margin': 'Bi√™n l·ª£i nhu·∫≠n (%)'
})

numeric_col_rename = ['Doanh thu', 'Chi·∫øt kh·∫•u', 'L·ª£i nhu·∫≠n', 'Chi ph√≠', 'Bi√™n l·ª£i nhu·∫≠n (%)']
corr_matrix = df_rename[numeric_col_rename].corr()

plt.figure(figsize=(8,6))
sns.heatmap(corr_matrix, annot=True, cmap='coolwarm')
plt.title('B·∫£ng T∆∞∆°ng Quan C√°c Ch·ªâ S·ªë Kinh Doanh Ch√≠nh')
plt.show()

"""NH·∫¨N X√âT

Bi·ªÉu ƒë·ªì t∆∞∆°ng quan cho th·∫•y m·ªôt s·ªë m·ªëi quan h·ªá ƒë√°ng ch√∫ √Ω gi·ªØa c√°c ch·ªâ s·ªë kinh doanh:

* Doanh thu (Sales) v√† Chi ph√≠ (Cost) c√≥ m·ªëi t∆∞∆°ng quan r·∫•t cao (0.93), cho th·∫•y khi doanh thu tƒÉng th√¨ chi ph√≠ c≈©ng tƒÉng t∆∞∆°ng ·ª©ng ‚Äî ph·∫£n √°nh quy m√¥ ho·∫°t ƒë·ªông m·ªü r·ªông.

* Chi·∫øt kh·∫•u (Discount) v√† Bi√™n l·ª£i nhu·∫≠n (Profit Margin %) c√≥ t∆∞∆°ng quan √¢m m·∫°nh (-0.86), ch·ª©ng t·ªè chi·∫øt kh·∫•u cao l√†m gi·∫£m m·∫°nh bi√™n l·ª£i nhu·∫≠n.

* Doanh thu (Sales) v√† L·ª£i nhu·∫≠n (Profit) c√≥ t∆∞∆°ng quan d∆∞∆°ng v·ª´a ph·∫£i (0.48), nghƒ©a l√† tƒÉng doanh thu kh√¥ng lu√¥n ƒë·ªìng nghƒ©a v·ªõi tƒÉng l·ª£i nhu·∫≠n ‚Äî c√≥ th·ªÉ do ·∫£nh h∆∞·ªüng c·ªßa chi·∫øt kh·∫•u ho·∫∑c chi ph√≠.

* Discount ‚Äì Profit: T∆∞∆°ng quan √¢m y·∫øu (-0.22) ‚Äî chi·∫øt kh·∫•u cao l√†m gi·∫£m l·ª£i nhu·∫≠n ƒë√°ng k·ªÉ.

**K·∫øt lu·∫≠n:** Vi·ªác tƒÉng chi·∫øt kh·∫•u ƒë·ªÉ ƒë·∫©y doanh thu c√≥ th·ªÉ l√†m gi·∫£m l·ª£i nhu·∫≠n bi√™n, do ƒë√≥ doanh nghi·ªáp c·∫ßn c√¢n ƒë·ªëi gi·ªØa tƒÉng tr∆∞·ªüng doanh thu v√† duy tr√¨ l·ª£i nhu·∫≠n.

### 3.11. D·ª± b√°o doanh thu
"""

from statsmodels.tsa.holtwinters import ExponentialSmoothing
import pandas as pd
import matplotlib.pyplot as plt

# 1Ô∏è‚É£ T·∫°o b·∫£ng doanh thu theo th√°ng
monthly_sales = (
    df.groupby(pd.Grouper(key='order_date', freq='M'))['sales']
    .sum()
    .reset_index()
)
monthly_sales.rename(columns={'order_date': 'Date'}, inplace=True)

# 2Ô∏è‚É£ Chuy·ªÉn 'Date' sang datetime v√† ƒë·∫∑t l√†m index
monthly_sales['Date'] = pd.to_datetime(monthly_sales['Date'])
y_series = monthly_sales.set_index('Date')['sales'].asfreq('ME').fillna(0)

# 3Ô∏è‚É£ T·∫°o m√¥ h√¨nh Holt-Winters (chu k·ª≥ m√πa v·ª• 12 th√°ng)
hw = ExponentialSmoothing(y_series, trend='add', seasonal='add', seasonal_periods=12)
hw_fit = hw.fit()

# 4Ô∏è‚É£ D·ª± b√°o 6 th√°ng ti·∫øp theo
fcast_vals = hw_fit.forecast(6)
future_idx = pd.date_range(y_series.index[-1] + pd.offsets.MonthEnd(1), periods=6, freq='ME')
fcast = pd.Series(fcast_vals, index=future_idx)

# 5Ô∏è‚É£ V·∫Ω bi·ªÉu ƒë·ªì th·ª±c t·∫ø v√† d·ª± b√°o
plt.figure(figsize=(12,4))
y_series.plot(label='Th·ª±c t·∫ø', color='blue')
fcast.plot(label='D·ª± b√°o', color='red', linestyle='--', marker='o')
plt.legend()
plt.title('D·ª± b√°o Doanh thu 6 Th√°ng (Holt‚ÄìWinters, m√πa=12)')
plt.xlabel('Th·ªùi gian')
plt.ylabel('Doanh thu')
plt.tight_layout()
plt.show()

"""NH·∫¨N X√âT
* Doanh thu c√≥ t√≠nh m√πa v·ª• r√µ, th∆∞·ªùng tƒÉng m·∫°nh v√†o cu·ªëi nƒÉm.

* D·ª± b√°o 6 th√°ng t·ªõi doanh thu tƒÉng nh·∫π nh∆∞ng kh√¥ng b·ª©t ph√°, n√™n c·∫ßn chu·∫©n b·ªã s·ªõm cho m√πa cao ƒëi·ªÉm.

* Doanh nghi·ªáp n√™n qu·∫£n l√Ω h√†ng t·ªìn kho ch·∫∑t ch·∫Ω h∆°n, tr√°nh ƒë·ªÉ h√†ng ·ª© khi nhu c·∫ßu gi·∫£m.

* T·∫≠p trung marketing tr∆∞·ªõc m√πa mua s·∫Øm, gi√∫p t·∫≠n d·ª•ng t·ªëi ƒëa giai ƒëo·∫°n doanh thu cao.

* N√™n m·ªü r·ªông s·∫£n ph·∫©m ho·∫∑c khu v·ª±c b√°n h√†ng m·ªõi ƒë·ªÉ gi·∫£m ph·ª• thu·ªôc v√†o m√πa v·ª• v√† gi·ªØ doanh thu ·ªïn ƒë·ªãnh quanh nƒÉm.

### 3.12. Ki·ªÉm ƒë·ªãnh gi·∫£ thuy·∫øt

**Ki·ªÉm ƒë·ªãnh: L·ª£i nhu·∫≠n trung b√¨nh c·ªßa giao h√†ng h·∫°ng chu·∫©n v√† giao h√†ng h·∫°ng hai b·∫±ng nhau**

* Gi·∫£ thuy·∫øt: L·ª£i nhu·∫≠n trung b√¨nh b·∫±ng nhau

H0: Œº_standard = Œº_second

* ƒê·ªëi thuy·∫øt: L·ª£i nhu·∫≠n trung b√¨nh kh√°c nhau ƒë√°ng k·ªÉ

H1: Œº_standard ‚â† Œº_second
"""

from scipy.stats import ttest_ind

mode_a = 'Standard Class'
mode_b = 'Second Class'

# Filter profit data for A and B groups
profit_mode_a = df[df['ship_mode'] == mode_a]['profit']
profit_mode_b = df[df['ship_mode'] == mode_b]['profit']

# Calculate descriptive statistics for A/B Test context
print("=== So s√°nh l·ª£i nhu·∫≠n gi·ªØa hai h√¨nh th·ª©c giao h√†ng ===")
print(f"Group A ({mode_a}) L·ª£i nhu·∫≠n trung b√¨nh: {profit_mode_a.mean():.2f} |S·ªë ƒë∆°n:{len(profit_mode_a)}")
print(f"Group B ({mode_b}) L·ª£i nhu·∫≠n trung b√¨nh: {profit_mode_b.mean():.2f} |S·ªë ƒë∆°n:{len(profit_mode_b)}")

# Perform Two-Sample T-test (assuming unequal variance: equal_var=False)
t_stat, p_value_ttest = ttest_ind(profit_mode_a, profit_mode_b, equal_var=False)

print("\n=== K·∫øt qu·∫£ ki·ªÉm ƒë·ªãnh T-test ===")
print(f"Gi√° tr·ªã T-statistic: {t_stat:.4f}")
print(f"P-value: {p_value_ttest:.4f}")

# --- K·∫øt lu·∫≠n ---
if p_value_ttest < 0.05:
    print("\nK·∫øt lu·∫≠n: C√≥ s·ª± kh√°c bi·ªát C√ì √ù NGHƒ®A TH·ªêNG K√ä gi·ªØa hai nh√≥m giao h√†ng.")
else:
    print("\nK·∫øt lu·∫≠n: KH√îNG c√≥ s·ª± kh√°c bi·ªát ƒë√°ng k·ªÉ v·ªÅ l·ª£i nhu·∫≠n gi·ªØa hai nh√≥m giao h√†ng.")

"""NH·∫¨N X√âT

- L·ª£i nhu·∫≠n trung b√¨nh c·ªßa hai nh√≥m (Standard Class: 27.49, Second Class: 29.54) c√≥ s·ª± ch√™nh l·ªách nh·ªè, nh∆∞ng kh√¥ng ƒë√°ng k·ªÉ v·ªÅ m·∫∑t th·ªëng k√™.

- Gi√° tr·ªã T-statistic = -0.4304 g·∫ßn b·∫±ng 0, c·ªßng c·ªë nh·∫≠n ƒë·ªãnh r·∫±ng m·ª©c l·ª£i nhu·∫≠n trung b√¨nh gi·ªØa hai h√¨nh th·ª©c giao h√†ng l√† t∆∞∆°ng ƒë∆∞∆°ng.

- P-value = 0.6669 > 0.05, nghƒ©a l√† kh√¥ng ƒë·ªß b·∫±ng ch·ª©ng ƒë·ªÉ b√°c b·ªè gi·∫£ thuy·∫øt H‚ÇÄ

‚Üí C√≥ th·ªÉ k·∫øt lu·∫≠n r·∫±ng c√°c y·∫øu t·ªë kh√°c (nh∆∞ lo·∫°i s·∫£n ph·∫©m, khu v·ª±c, ch√≠nh s√°ch gi√° ho·∫∑c chi·∫øt kh·∫•u) m·ªõi l√† nguy√™n nh√¢n ch√≠nh ·∫£nh h∆∞·ªüng ƒë·∫øn l·ª£i nhu·∫≠n, ch·ª© kh√¥ng ph·∫£i h√¨nh th·ª©c giao h√†ng

**Ki·ªÉm ƒë·ªãnh ANOVA: So s√°nh doanh thu trung b√¨nh gi·ªØa c√°c khu v·ª±c (Region)**

* Gi·∫£ thuy·∫øt (H0): Doanh thu trung b√¨nh gi·ªØa c√°c khu v·ª±c l√† b·∫±ng nhau

* ƒê·ªëi thuy·∫øt (H1): C√≥ √≠t nh·∫•t m·ªôt khu v·ª±c c√≥ doanh thu trung b√¨nh kh√°c bi·ªát ƒë√°ng k·ªÉ so v·ªõi c√°c khu v·ª±c c√≤n l·∫°i
"""

from scipy.stats import f_oneway
import statsmodels.formula.api as smf
from statsmodels.stats.anova import anova_lm

# Gather sales data per region
region_sales = [df[df['region'] == r]['sales'] for r in df['region'].unique()]

# Perform One-Way ANOVA
f_stat_anova, p_value_anova = f_oneway(*region_sales)

print("--- K·∫æT QU·∫¢ KI·ªÇM ƒê·ªäNH ANOVA (Doanh thu theo Khu v·ª±c) ---")
print(f"F-Statistic: {f_stat_anova:.4f}, P-Value: {p_value_anova:.4f}")

if p_value_anova < 0.05:
    print("B√°c b·ªè H0: C√≥ s·ª± kh√°c bi·ªát ƒë√°ng k·ªÉ v·ªÅ doanh thu gi·ªØa c√°c khu v·ª±c.")
else:
    print("Kh√¥ng b√°c b·ªè H0: Ch∆∞a c√≥ b·∫±ng ch·ª©ng cho th·∫•y doanh thu kh√°c bi·ªát gi·ªØa c√°c khu v·ª±c.")

# Display the formal ANOVA table for comprehensive output
formula = 'sales ~ C(region)'
lm = smf.ols(formula, data=df).fit()
anova_table = anova_lm(lm)
print("\nB·∫£ng ANOVA Chi ti·∫øt:")
print(anova_table)
print("\nDescriptive Statistics: Doanh thu trung b√¨nh theo t·ª´ng khu v·ª±c")
print(df.groupby('region', observed=False)['sales'].mean().sort_values(ascending=False).round(2))

"""NH·∫¨N X√âT

* P-value = 0.4933 l·ªõn h∆°n 0.05 ‚Üí kh√¥ng c√≥ ƒë·ªß b·∫±ng ch·ª©ng ƒë·ªÉ k·∫øt lu·∫≠n r·∫±ng khu v·ª±c b√°n h√†ng ·∫£nh h∆∞·ªüng ƒë·∫øn doanh thu

* B·∫£ng ANOVA cho th·∫•y ph·∫ßn ph∆∞∆°ng sai gi·ªØa c√°c khu v·ª±c (sum_sq = 933,020) r·∫•t nh·ªè so v·ªõi ph·∫ßn ph∆∞∆°ng sai c√≤n l·∫°i (sum_sq = 3,880,692,000).
‚Üí ƒêi·ªÅu n√†y cho th·∫•y s·ª± kh√°c bi·ªát doanh thu gi·ªØa c√°c khu v·ª±c l√† r·∫•t nh·ªè so v·ªõi bi·∫øn ƒë·ªông chung trong to√†n b·ªô d·ªØ li·ªáu.

* Doanh thu ph√¢n b·ªë kh√° ƒë·ªìng ƒë·ªÅu gi·ªØa c√°c khu v·ª±c, s·ª± kh√°c bi·ªát quan s√°t ƒë∆∞·ª£c ch·ªâ l√† ng·∫´u nhi√™n, kh√¥ng ƒë·ªß m·∫°nh ƒë·ªÉ kh·∫≥ng ƒë·ªãnh c√≥ s·ª± kh√°c bi·ªát th·ª±c s·ª±

**Ki·ªÉm ƒë·ªãnh Chi-square: M·ªëi quan h·ªá gi·ªØa Ph√¢n kh√∫c kh√°ch h√†ng (Segment) v√† H√¨nh th·ª©c giao h√†ng (Ship Mode)**

* Gi·∫£ thuy·∫øt (H0): Ph√¢n kh√∫c kh√°ch h√†ng v√† h√¨nh th·ª©c giao h√†ng ƒë·ªôc l·∫≠p v·ªõi nhau (kh√¥ng c√≥ m·ªëi li√™n h·ªá)

* ƒê·ªëi thuy·∫øt (H1): Ph√¢n kh√∫c kh√°ch h√†ng v√† h√¨nh th·ª©c giao h√†ng c√≥ m·ªëi li√™n h·ªá ph·ª• thu·ªôc l·∫´n nhau
"""

from scipy.stats import chi2_contingency

contingency_table = pd.crosstab(df['segment'], df['ship_mode'])

# Perform the Chi-squared Test for Independence
# H0: Segment and Ship Mode are independent
chi2_stat, p_value_chi2, dof, expected = chi2_contingency(contingency_table)

print("--- K·∫æT QU·∫¢ KI·ªÇM ƒê·ªäNH CHI-B√åNH PH∆Ø∆†NG (Segment v√† Ship Mode) ---")
print(f"Chi2-Statistic: {chi2_stat:.4f}, P-Value: {p_value_chi2:.4f}, Degrees of Freedom: {dof}")

if p_value_chi2 < 0.05:
    print("K·∫øt lu·∫≠n: B√°c b·ªè H0. C√≥ m·ªëi quan h·ªá gi·ªØa Ph√¢n kh√∫c kh√°ch h√†ng (Segment) v√† H√¨nh th·ª©c giao h√†ng (Ship Mode)")
else:
    print("K·∫øt lu·∫≠n: Kh√¥ng b√°c b·ªè H0. Ch∆∞a c√≥ b·∫±ng ch·ª©ng cho th·∫•y c√≥ m·ªëi quan h·ªá gi·ªØa Segment v√† Ship Mode")

print("\nContingency Table:")
print(contingency_table)

"""NH·∫¨N X√âT

* C·∫£ ba ph√¢n kh√∫c ƒë·ªÅu c√≥ t·ª∑ l·ªá d√πng ‚ÄúStandard Class‚Äù cao nh·∫•t, cho th·∫•y ƒë√¢y l√† h√¨nh th·ª©c giao h√†ng ph·ªï bi·∫øn nh·∫•t.

* Consumer l√† nh√≥m d√πng ‚ÄúSame Day‚Äù nhi·ªÅu nh·∫•t v·ªÅ s·ªë l∆∞·ª£ng tuy·ªát ƒë·ªëi (317 ƒë∆°n), cho th·∫•y nhu c·∫ßu giao nhanh cao h∆°n.

* Home Office chi·∫øm t·ª∑ l·ªá nh·ªè h∆°n trong t·∫•t c·∫£ c√°c lo·∫°i h√¨nh giao h√†ng

* Doanh nghi·ªáp c√≥ th·ªÉ d·ª±a v√†o ƒë·∫∑c ƒëi·ªÉm t·ª´ng ph√¢n kh√∫c ƒë·ªÉ ƒëi·ªÅu ch·ªânh ch√≠nh s√°ch v·∫≠n chuy·ªÉn - v√≠ d·ª•:

    TƒÉng c∆∞·ªùng d·ªãch v·ª• ‚ÄúSame Day‚Äù cho nh√≥m Consumer,

    Duy tr√¨ d·ªãch v·ª• ‚ÄúFirst Class‚Äù cho nh√≥m Corporate,

    T·ªëi ∆∞u chi ph√≠ giao h√†ng ti√™u chu·∫©n cho Home Office.

**Ki·ªÉm ƒë·ªãnh: Customer Segment (ph√¢n kh√∫c kh√°ch h√†ng) c√≥ ·∫£nh h∆∞·ªüng ƒë√°ng k·ªÉ ƒë·∫øn l·ª£i nhu·∫≠n trung b√¨nh tr√™n m·ªói ƒë∆°n h√†ng (Average Profit per Order) hay kh√¥ng?**

* Gi·∫£ thuy·∫øt H0: Trung b√¨nh l·ª£i nhu·∫≠n tr√™n m·ªói ƒë∆°n h√†ng kh√¥ng kh√°c nhau gi·ªØa c√°c nh√≥m kh√°ch h√†ng

* ƒê·ªëi thuy·∫øt H1: C√≥ √≠t nh·∫•t m·ªôt nh√≥m kh√°ch h√†ng c√≥ trung b√¨nh l·ª£i nhu·∫≠n kh√°c bi·ªát ƒë√°ng k·ªÉ so v·ªõi nh√≥m kh√°c.
"""

from scipy import stats

# T√≠nh profit trung b√¨nh tr√™n m·ªói ƒë∆°n h√†ng cho t·ª´ng nh√≥m kh√°ch h√†ng
grouped = df.groupby('segment')['profit'].mean()

# Chu·∫©n b·ªã d·ªØ li·ªáu cho ki·ªÉm ƒë·ªãnh ANOVA
segment_groups = [df[df['segment'] == seg]['profit'] for seg in df['segment'].unique()]

# Th·ª±c hi·ªán ki·ªÉm ƒë·ªãnh ANOVA m·ªôt y·∫øu t·ªë
f_stat, p_value = stats.f_oneway(*segment_groups)

# In k·∫øt qu·∫£
print("=== K·∫øt qu·∫£ ANOVA test ===")
print(f"F-statistic: {f_stat:.4f}")
print(f"P-value: {p_value:.4f}")

# K·∫øt lu·∫≠n
if p_value < 0.05:
    print("=> K·∫øt lu·∫≠n: Customer Segment ·∫£nh h∆∞·ªüng ƒê√ÅNG K·ªÇ ƒë·∫øn Average Profit per Order (c√≥ √Ω nghƒ©a th·ªëng k√™).")
else:
    print("=> K·∫øt lu·∫≠n: KH√îNG c√≥ s·ª± kh√°c bi·ªát ƒë√°ng k·ªÉ v·ªÅ Average Profit per Order gi·ªØa c√°c Customer Segment.")

"""NH·∫¨N X√âT

- Gi√° tr·ªã F = 0.8981 v√† p-value = 0.4074 > 0.05, cho th·∫•y kh√¥ng ƒë·ªß b·∫±ng ch·ª©ng th·ªëng k√™ ƒë·ªÉ b√°c b·ªè gi·∫£ thuy·∫øt H‚ÇÄ. ƒêi·ªÅu ƒë√≥ c√≥ nghƒ©a l√† l·ª£i nhu·∫≠n trung b√¨nh tr√™n m·ªói ƒë∆°n h√†ng (Average Profit per Order) kh√¥ng kh√°c bi·ªát ƒë√°ng k·ªÉ gi·ªØa c√°c nh√≥m kh√°ch h√†ng (Customer Segment).

- N√≥i c√°ch kh√°c, ph√¢n kh√∫c kh√°ch h√†ng (Consumer, Corporate, Home Office) kh√¥ng ·∫£nh h∆∞·ªüng r√µ r·ªát ƒë·∫øn l·ª£i nhu·∫≠n trung b√¨nh. C√≥ th·ªÉ c√°c y·∫øu t·ªë kh√°c nh∆∞ lo·∫°i s·∫£n ph·∫©m, chi·∫øt kh·∫•u m·ªõi l√† nh·ªØng bi·∫øn s·ªë t√°c ƒë·ªông m·∫°nh h∆°n ƒë·∫øn l·ª£i nhu·∫≠n.

**Ki·ªÉm ƒë·ªãnh h·ªìi quy tuy·∫øn t√≠nh ƒëa bi·∫øn v·ªÅ c√°c y·∫øu t·ªë ·∫£nh h∆∞·ªüng ƒë·∫øn l·ª£i nhu·∫≠n**
"""

import statsmodels.api as sm
import numpy as np

# c√°c c·ªôt: 'profit', 'sales', 'discount', 'category', 'ship_mode'

# T·∫°o bi·∫øn gi·∫£ (dummy variables) cho c√°c bi·∫øn ph√¢n lo·∫°i
df_dummy = pd.get_dummies(df, columns=['category', 'ship_mode'], drop_first=False)

# X√°c ƒë·ªãnh bi·∫øn ƒë·ªôc l·∫≠p (X) v√† bi·∫øn ph·ª• thu·ªôc (y)
# Explicitly select only the numeric and dummy variables for X
X = df_dummy[['sales', 'discount', 'category_Furniture', 'category_Office Supplies',
              'category_Technology', 'ship_mode_First Class', 'ship_mode_Same Day',
              'ship_mode_Second Class', 'ship_mode_Standard Class']]
y = df_dummy['profit']

# Cast both X and y to standard NumPy float types
X = X.astype(np.float64)
y = y.astype(np.float64)


# Add a constant to the independent variables
X = sm.add_constant(X)

# X√¢y d·ª±ng m√¥ h√¨nh h·ªìi quy tuy·∫øn t√≠nh
model = sm.OLS(y, X).fit()
print(model.summary())

"""NH·∫¨N X√âT

* M√¥ h√¨nh h·ªìi quy tuy·∫øn t√≠nh cho th·∫•y Sales, Discount, v√† Category l√† c√°c y·∫øu t·ªë ·∫£nh h∆∞·ªüng c√≥ √Ω nghƒ©a th·ªëng k√™ ƒë·∫øn l·ª£i nhu·∫≠n
  * Doanh thu (Sales) l√† y·∫øu t·ªë t√≠ch c·ª±c, c√≥ ·∫£nh h∆∞·ªüng m·∫°nh nh·∫•t ƒë·∫øn l·ª£i nhu·∫≠n, khi doanh thu tƒÉng, l·ª£i nhu·∫≠n tƒÉng t∆∞∆°ng ·ª©ng
  * Chi·∫øt kh·∫•u (Discount) l√† y·∫øu t·ªë ti√™u c·ª±c, ·∫£nh h∆∞·ªüng m·∫°nh nh·∫•t ‚Äì c·∫ßn ki·ªÉm so√°t ch·∫∑t ch√≠nh s√°ch gi·∫£m gi√° v√¨ n√≥ l√†m gi·∫£m ƒë√°ng k·ªÉ l·ª£i nhu·∫≠n (v√¨ m·ª©c chi·∫øt kh·∫•u c√†ng cao th√¨ l·ª£i nhu·∫≠n gi·∫£m m·∫°nh)
  * Lo·∫°i s·∫£n ph·∫©m (Category) c√≥ ·∫£nh h∆∞·ªüng ƒë√°ng k·ªÉ, trong ƒë√≥ Office Supplies v√† Technology mang l·∫°i l·ª£i nhu·∫≠n t·ªët h∆°n nh√≥m tham chi·∫øu (Furniture)
  * H√¨nh th·ª©c giao h√†ng (Ship Mode) kh√¥ng ·∫£nh h∆∞·ªüng r√µ r·ªát ƒë·∫øn l·ª£i nhu·∫≠n, kh·ªõp v·ªõi k·∫øt qu·∫£ ki·ªÉm ƒë·ªãnh T-test tr∆∞·ªõc ƒë√≥

## 4. K·∫øt qu·∫£

**K·∫øt qu·∫£ ch√≠nh**

* Office Supplies: doanh s·ªë cao nh·∫•t nh∆∞ng l·ª£i nhu·∫≠n th·∫•p ‚Äì gi√∫p duy tr√¨ d√≤ng ti·ªÅn.

* Furniture: doanh thu l·ªõn nh∆∞ng bi√™n l·ª£i nhu·∫≠n ch·ªâ ~2.5% ‚Üí r·ªßi ro t√†i ch√≠nh cao.

* Technology: d·∫´n ƒë·∫ßu c·∫£ doanh thu v√† l·ª£i nhu·∫≠n ‚Üí m·∫£ng c·ªët l√µi n√™n t·∫≠p trung ƒë·∫ßu t∆∞.

* Tables & Bookcases l·ªó n·∫∑ng, Copiers sinh l·ªùi t·ªët nh·∫•t.

* Chi·∫øt kh·∫•u cao l√†m gi·∫£m m·∫°nh l·ª£i nhu·∫≠n, nh∆∞ng kh√¥ng gi√∫p tƒÉng doanh s·ªë ƒë√°ng k·ªÉ.

**Theo v√πng v√† kh√°ch h√†ng**

* West & East: d·∫´n ƒë·∫ßu v·ªÅ c·∫£ doanh thu v√† l·ª£i nhu·∫≠n.

* Central: doanh s·ªë trung b√¨nh nh∆∞ng l·ª£i nhu·∫≠n th·∫•p ‚Üí c·∫ßn t·ªëi ∆∞u v·∫≠n h√†nh.

* South: doanh s·ªë th·∫•p nh∆∞ng t·ª∑ su·∫•t l·ª£i nhu·∫≠n kh√° ·ªïn.

* Kh√°ch h√†ng Consumer & Corporate chi·∫øm ~80% doanh thu; nh√≥m Home Office tuy nh·ªè nh∆∞ng hi·ªáu qu·∫£

**Di·ªÖn bi·∫øn theo th·ªùi gian**

* Doanh thu v√† l·ª£i nhu·∫≠n tƒÉng m·∫°nh v√†o cu·ªëi nƒÉm, ƒë·∫∑c bi·ªát d·ªãp l·ªÖ.

* Tuy nhi√™n, tƒÉng doanh thu kh√¥ng lu√¥n ƒëi k√®m tƒÉng l·ª£i nhu·∫≠n, cho th·∫•y v·∫•n ƒë·ªÅ trong qu·∫£n l√Ω chi ph√≠ ho·∫∑c ch√≠nh s√°ch gi·∫£m gi√°.

**Ph√¢n t√≠ch t∆∞∆°ng quan**

* Discount ‚Äì Profit: T∆∞∆°ng quan √¢m y·∫øu (-0.22) ‚Äî chi·∫øt kh·∫•u cao l√†m gi·∫£m l·ª£i nhu·∫≠n ƒë√°ng k·ªÉ.
* Doanh thu (Sales) v√† L·ª£i nhu·∫≠n (Profit) c√≥ t∆∞∆°ng quan d∆∞∆°ng v·ª´a ph·∫£i (0.48), nghƒ©a l√† tƒÉng doanh thu kh√¥ng lu√¥n ƒë·ªìng nghƒ©a v·ªõi tƒÉng l·ª£i nhu·∫≠n ‚Äî c√≥ th·ªÉ do ·∫£nh h∆∞·ªüng c·ªßa chi·∫øt kh·∫•u ho·∫∑c chi ph√≠.

## 5. K·∫øt lu·∫≠n

* Ph√¢n t√≠ch m√¥ t·∫£ cho th·∫•y doanh thu c√≥ xu h∆∞·ªõng bi·∫øn ƒë·ªông theo m√πa, v·ªõi c√°c giai ƒëo·∫°n tƒÉng m·∫°nh v√†o gi·ªØa v√† cu·ªëi nƒÉm. Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn ‚ÄúStandard Class‚Äù chi·∫øm t·ª∑ tr·ªçng ƒë∆°n h√†ng l·ªõn nh·∫•t, trong khi ‚ÄúSame Day‚Äù c√≥ th·ªùi gian giao h√†ng ng·∫Øn nh·∫•t nh∆∞ng chi ph√≠ cao h∆°n n√™n chi·∫øm t·ª∑ tr·ªçng r·∫•t nh·ªè.

* K·∫øt qu·∫£ ph√¢n t√≠ch t∆∞∆°ng quan ch·ªâ ra r·∫±ng chi·∫øt kh·∫•u c√≥ m·ªëi quan h·ªá ngh·ªãch v·ªõi l·ª£i nhu·∫≠n v√† bi√™n l·ª£i nhu·∫≠n, cho th·∫•y vi·ªác gi·∫£m chi·∫øt kh·∫•u c√≥ th·ªÉ gi√∫p c·∫£i thi·ªán hi·ªáu qu·∫£ kinh doanh.

* M√¥ h√¨nh Holt‚ÄìWinters Exponential Smoothing cho th·∫•y doanh thu d·ª± ki·∫øn s·∫Ω ti·∫øp t·ª•c tƒÉng nh·∫π trong 6‚Äì12 th√°ng t·ªõi, ph·∫£n √°nh xu h∆∞·ªõng t√≠ch c·ª±c nh∆∞ng c√≥ y·∫øu t·ªë dao ƒë·ªông theo m√πa.

* C√°c k·ªãch b·∫£n gi·∫£ ƒë·ªãnh v·ªÅ vi·ªác gi·∫£m chi·∫øt kh·∫•u xu·ªëng ·ªü m·ª©c d∆∞·ªõi 20% c√≥ th·ªÉ gi√∫p t·ªëi ∆∞u l·ª£i nhu·∫≠n t·ªïng th·ªÉ m√† kh√¥ng ·∫£nh h∆∞·ªüng l·ªõn ƒë·∫øn doanh thu. ƒêi·ªÅu n√†y cung c·∫•p cƒÉn c·ª© cho vi·ªác ƒëi·ªÅu ch·ªânh ch√≠nh s√°ch chi·∫øt kh·∫•u nh·∫±m c√¢n b·∫±ng gi·ªØa tƒÉng tr∆∞·ªüng doanh thu v√† bi√™n l·ª£i nhu·∫≠n.
"""